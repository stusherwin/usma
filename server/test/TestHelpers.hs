{-# LANGUAGE OverloadedStrings, ScopedTypeVariables, LambdaCase, ViewPatterns #-}

module TestHelpers where

import qualified Data.ByteString as B (ByteString)
import qualified Data.ByteString.Char8 as B (breakSubstring, dropWhile, drop, concat, length, takeWhile)
import qualified Data.ByteString.Lazy as BL (ByteString, fromStrict, toStrict)
import qualified Data.ByteString.Lazy.Char8 as BL (pack)
import           Test.Hspec
import           Test.Hspec.Wai
import           Test.Hspec.Wai.Matcher
import           Prelude ()
import           Prelude.Compat

import           Control.Monad
import           Network.Wai.Test
import           System.Directory (getCurrentDirectory)

import           Config (Config(..))
import           UpgradeDB (upgradeDB, runScript)
import qualified ProductImage as V1 (FetchProductImage)
import qualified SumaCatalogue as V2 (FetchProductImage)

ignoreFieldSpec :: Spec
ignoreFieldSpec =
  describe "ignoreField" $ do
    let strWithField = "{\"groupSettings\":{\"enablePayments\":true},\"pastHouseholdOrders\":[],\"households\":[{\"contactPhone\":null,\"contactEmail\":null,\"totalOrders\":0,\"totalPayments\":0,\"balance\":0,\"name\":\"Test Household 1\",\"contactName\":null,\"id\":1},{\"contactPhone\":null,\"contactEmail\":null,\"totalOrders\":0,\"totalPayments\":0,\"balance\":0,\"name\":\"Test Household 2\",\"contactName\":null,\"id\":2},{\"contactPhone\":null,\"contactEmail\":null,\"totalOrders\":0,\"totalPayments\":0,\"balance\":0,\"name\":\"Test Household 3\",\"contactName\":null,\"id\":3}],\"householdOrders\":[{\"orderIsAbandoned\":false,\"totalExcVat\":0,\"adjustment\":null,\"isAbandoned\":false,\"totalIncVat\":0,\"orderCreatedBy\":1,\"isComplete\":false,\"orderIsPlaced\":false,\"items\":[],\"householdId\":1,\"householdName\":\"Test Household 1\",\"orderCreatedByName\":\"Test Household 1\",\"orderId\":1,\"isOpen\":true}],\"pastCollectiveOrders\":[],\"householdPayments\":[],\"collectiveOrder\":{\"orderIsAbandoned\":false,\"totalExcVat\":0,\"adjustment\":null,\"totalIncVat\":0,\"orderCreatedBy\":1,\"isComplete\":false,\"orderIsPlaced\":false,\"items\":[],\"orderCreatedDate\":\"2020-07-24T15:13:59Z\",\"orderCreatedByName\":\"Test Household 1\",\"id\":1,\"allHouseholdsUpToDate\":true}}"
    let strWith2Fields = "{\"groupSettings\":{\"enablePayments\":true},\"pastHouseholdOrders\":[],\"households\":[{\"contactPhone\":null,\"contactEmail\":null,\"totalOrders\":0,\"totalPayments\":0,\"balance\":0,\"name\":\"Test Household 1\",\"contactName\":null,\"id\":1},{\"contactPhone\":null,\"contactEmail\":null,\"totalOrders\":0,\"totalPayments\":0,\"balance\":0,\"name\":\"Test Household 2\",\"contactName\":null,\"id\":2},{\"contactPhone\":null,\"contactEmail\":null,\"totalOrders\":0,\"totalPayments\":0,\"balance\":0,\"name\":\"Test Household 3\",\"contactName\":null,\"id\":3}],\"householdOrders\":[{\"orderIsAbandoned\":false,\"totalExcVat\":0,\"adjustment\":null,\"isAbandoned\":false,\"totalIncVat\":0,\"orderCreatedBy\":1,\"isComplete\":false,\"orderIsPlaced\":false,\"items\":[],\"householdId\":1,\"householdName\":\"Test Household 1\",\"orderCreatedByName\":\"Test Household 1\",\"orderId\":1,\"isOpen\":true}],\"pastCollectiveOrders\":[],\"householdPayments\":[],\"collectiveOrder\":{\"orderIsAbandoned\":false,\"totalExcVat\":0,\"adjustment\":null,\"totalIncVat\":0,\"orderCreatedBy\":1,\"isComplete\":false,\"orderIsPlaced\":false,\"items\":[],\"orderCreatedDate\":\"2020-07-24T15:13:59Z\",\"orderCreatedDate\":\"2020-07-24T15:13:59Z\",\"orderCreatedByName\":\"Test Household 1\",\"id\":1,\"allHouseholdsUpToDate\":true}}"
    let strWithoutField = "{\"groupSettings\":{\"enablePayments\":true},\"pastHouseholdOrders\":[],\"households\":[{\"contactPhone\":null,\"contactEmail\":null,\"totalOrders\":0,\"totalPayments\":0,\"balance\":0,\"name\":\"Test Household 1\",\"contactName\":null,\"id\":1},{\"contactPhone\":null,\"contactEmail\":null,\"totalOrders\":0,\"totalPayments\":0,\"balance\":0,\"name\":\"Test Household 2\",\"contactName\":null,\"id\":2},{\"contactPhone\":null,\"contactEmail\":null,\"totalOrders\":0,\"totalPayments\":0,\"balance\":0,\"name\":\"Test Household 3\",\"contactName\":null,\"id\":3}],\"householdOrders\":[{\"orderIsAbandoned\":false,\"totalExcVat\":0,\"adjustment\":null,\"isAbandoned\":false,\"totalIncVat\":0,\"orderCreatedBy\":1,\"isComplete\":false,\"orderIsPlaced\":false,\"items\":[],\"householdId\":1,\"householdName\":\"Test Household 1\",\"orderCreatedByName\":\"Test Household 1\",\"orderId\":1,\"isOpen\":true}],\"pastCollectiveOrders\":[],\"householdPayments\":[],\"collectiveOrder\":{\"orderIsAbandoned\":false,\"totalExcVat\":0,\"adjustment\":null,\"totalIncVat\":0,\"orderCreatedBy\":1,\"isComplete\":false,\"orderIsPlaced\":false,\"items\":[],\"orderCreatedByName\":\"Test Household 1\",\"id\":1,\"allHouseholdsUpToDate\":true}}"
    it "should remove json field from string" $ do
      ignoreField "orderCreatedDate" strWithField `shouldBe` strWithoutField
    it "should remove all matching fields from string" $ do
      ignoreField "orderCreatedDate" strWith2Fields `shouldBe` strWithoutField
    it "should leave string without matching field untouched" $ do
      ignoreField "orderCreatedDate" strWithoutField `shouldBe` strWithoutField

ignoringField :: B.ByteString -> MatchBody -> MatchBody
ignoringField fieldName (MatchBody fn) = MatchBody (\h b -> fn h (BL.fromStrict $ ignoreField fieldName $ BL.toStrict b))

ignoreField :: B.ByteString -> B.ByteString -> B.ByteString
ignoreField fieldName str = 
  let fieldStart = B.concat [",\"", fieldName, "\":\""]
  in  case B.breakSubstring fieldStart str of
    (before, "") -> before
    (before, after) -> B.concat [before, ignoreField fieldName $ B.drop 1 $ B.dropWhile (/= '\"') $ B.drop (B.length fieldStart) after]

bodyEquals' :: (B.ByteString -> B.ByteString) -> BL.ByteString -> MatchBody
bodyEquals' bodyFn bodyToMatch = 
  let (MatchBody fn) = bodyEquals $ BL.fromStrict $ bodyFn $ BL.toStrict bodyToMatch
  in  MatchBody (\h b -> fn h (BL.fromStrict $ bodyFn $ BL.toStrict b))

getFieldValue :: B.ByteString -> B.ByteString -> B.ByteString
getFieldValue fieldName str = 
  let fieldStart = B.concat [",\"", fieldName, "\":\""]
  in  case B.breakSubstring fieldStart str of
    (_, "") -> ""
    (_, after) -> B.takeWhile (/= '\"') $ B.drop (B.length fieldStart) after

replaceFieldValue :: B.ByteString -> B.ByteString -> B.ByteString -> B.ByteString
replaceFieldValue fieldName value str = 
  let fieldStart = B.concat [",\"", fieldName, "\":\""]
  in  case B.breakSubstring fieldStart str of
    (_, "") -> ""
    (before, after) -> B.concat [before, fieldStart, value, B.dropWhile (/= '\"') $ B.drop (B.length fieldStart) after]

shouldMatch :: SResponse -> ResponseMatcher -> WaiExpectation st
shouldMatch r matcher = forM_ (match r matcher) (liftIO . expectationFailure)

mockFetchProductImageV1 :: V1.FetchProductImage
mockFetchProductImageV1 _ "BT470" = return $ Just $ BL.pack "\255\216\255\224\NUL\DLEJFIF\NUL\SOH\SOH\SOH\NUL\165\NUL\165\NUL\NUL\255\225\NUL\138Exif\NUL\NULMM\NUL*\NUL\NUL\NUL\b\NUL\a\SOH\SUB\NUL\ENQ\NUL\NUL\NUL\SOH\NUL\NUL\NULb\SOH\ESC\NUL\ENQ\NUL\NUL\NUL\SOH\NUL\NUL\NULj\SOH(\NUL\ETX\NUL\NUL\NUL\SOH\NUL\ETX\NUL\NUL\SOH1\NUL\STX\NUL\NUL\NUL\DLE\NUL\NUL\NULrQ\DLE\NUL\SOH\NUL\NUL\NUL\SOH\SOH\NUL\NUL\NULQ\DC1\NUL\EOT\NUL\NUL\NUL\SOH\NUL\NUL\EMNQ\DC2\NUL\EOT\NUL\NUL\NUL\SOH\NUL\NUL\EMN\NUL\NUL\NUL\NUL\NUL\NUL\253\v\NUL\NUL\ETX\232\NUL\NUL\253\v\NUL\NUL\ETX\232paint.net 4.1.5\NUL\255\219\NULC\NUL\STX\SOH\SOH\STX\SOH\SOH\STX\STX\STX\STX\STX\STX\STX\STX\ETX\ENQ\ETX\ETX\ETX\ETX\ETX\ACK\EOT\EOT\ETX\ENQ\a\ACK\a\a\a\ACK\a\a\b\t\v\t\b\b\n\b\a\a\n\r\n\n\v\f\f\f\f\a\t\SO\SI\r\f\SO\v\f\f\f\255\219\NULC\SOH\STX\STX\STX\ETX\ETX\ETX\ACK\ETX\ETX\ACK\f\b\a\b\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\255\192\NUL\DC1\b\NUL\135\NUL\135\ETX\SOH\"\NUL\STX\DC1\SOH\ETX\DC1\SOH\255\196\NUL\US\NUL\NUL\SOH\ENQ\SOH\SOH\SOH\SOH\SOH\SOH\NUL\NUL\NUL\NUL\NUL\NUL\NUL\NUL\SOH\STX\ETX\EOT\ENQ\ACK\a\b\t\n\v\255\196\NUL\181\DLE\NUL\STX\SOH\ETX\ETX\STX\EOT\ETX\ENQ\ENQ\EOT\EOT\NUL\NUL\SOH}\SOH\STX\ETX\NUL\EOT\DC1\ENQ\DC2!1A\ACK\DC3Qa\a\"q\DC42\129\145\161\b#B\177\193\NAKR\209\240$3br\130\t\n\SYN\ETB\CAN\EM\SUB%&'()*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz\131\132\133\134\135\136\137\138\146\147\148\149\150\151\152\153\154\162\163\164\165\166\167\168\169\170\178\179\180\181\182\183\184\185\186\194\195\196\197\198\199\200\201\202\210\211\212\213\214\215\216\217\218\225\226\227\228\229\230\231\232\233\234\241\242\243\244\245\246\247\248\249\250\255\196\NUL\US\SOH\NUL\ETX\SOH\SOH\SOH\SOH\SOH\SOH\SOH\SOH\SOH\NUL\NUL\NUL\NUL\NUL\NUL\SOH\STX\ETX\EOT\ENQ\ACK\a\b\t\n\v\255\196\NUL\181\DC1\NUL\STX\SOH\STX\EOT\EOT\ETX\EOT\a\ENQ\EOT\EOT\NUL\SOH\STXw\NUL\SOH\STX\ETX\DC1\EOT\ENQ!1\ACK\DC2AQ\aaq\DC3\"2\129\b\DC4B\145\161\177\193\t#3R\240\NAKbr\209\n\SYN$4\225%\241\ETB\CAN\EM\SUB&'()*56789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz\130\131\132\133\134\135\136\137\138\146\147\148\149\150\151\152\153\154\162\163\164\165\166\167\168\169\170\178\179\180\181\182\183\184\185\186\194\195\196\197\198\199\200\201\202\210\211\212\213\214\215\216\217\218\226\227\228\229\230\231\232\233\234\242\243\244\245\246\247\248\249\250\255\218\NUL\f\ETX\SOH\NUL\STX\DC1\ETX\DC1\NUL?\NUL\253\252\162\138(\NUL\162\138(\NUL\162\138(\NUL\162\138(\NUL\162\138(\NUL\162\138(\NUL\162\138(\NUL\162\138(\NUL\162\138(\NUL\162\138(\NUL\162\138(\NUL\162\138(\NUL\162\138(\NUL\162\138(\NUL\162\138(\NUL\162\138(\NUL\162\138(\NUL\162\138(\NUL\162\138(\NUL\162\138(\NUL\175\159\252g\255\NUL\ENQ\\\253\153~\GS\248\150\239G\215>>\252\"\210\245K\t\SUB\ESC\155Y\252Uf\178\192\234p\202\195\204\225\129\EOT\DLEy\ACK\190N\255\NUL\131\177?j\175\SYN~\203\DEL\240J)\151\193\250\149\230\143}\241\DC3\197V^\DC1\187\189\180\148\195q\ENQ\164\182\215wS\EOTu\228y\139i\229\FSuY\CANw\175\228\226\169+\129\253\178\DEL\195\228\191d\255\NUL\250\&8\207\131?\248VY\255\NUL\241\202?\225\242_\178\DEL\253\FSg\193\159\252+,\255\NUL\248\229\DEL\DC3tQ\202\a\246\201\255\NUL\SI\146\253\147\255\NUL\232\227>\f\255\NUL\225Yg\255\NUL\199(\255\NUL\135\201~\201\255\NUL\244q\159\ACK\DEL\240\172\179\255\NUL\227\149\252M\209G(\US\219'\252>K\246O\255\NUL\163\140\248\&3\255\NUL\133e\159\255\NUL\FS\174\239\224O\237\229\240O\246\160\241\EOT\186O\195\159\139\US\SI|o\171C\EM\153\236\180]z\218\242\225Puo-\FS\182\209\220\227\STX\191\134\n\222\248[\241G\196?\EOT\254\"\232\190.\240\158\175}\160\248\147\195\183q\223i\218\133\156\166)\237fC\149ea\249\DC1\208\130A\200&\142P?\189\170+\205\DELc/\141\ETB\DEL\180\135\236}\240\167\226%\253\188v\183\222=\240v\145\226;\136c\251\176\201ye\r\195(\246\r!\US\133zUH\ENQ\DC4Q@\ENQ\DC4Q@\ENQ\DC4Q@\ENQ\DC4Q@\US\144_\240z\159\252\162\207\192?\246Ut\239\253\&4k\NAK\252\194W\244\247\255\NUL\a\169\255\NUL\202,\252\ETX\255\NULeWN\255\NUL\211F\177_\204%T@(\162\189C\246\145\253\138\190+\254\200\DLExf_\137\222\ETX\241\ETB\130\227\241\149\128\212\244f\212\173\252\177}\SOH\198J\156\156\&0\220\187\163l:\238]\202\&23@{\151\252\DLE\199\254\t\199\167\255\NUL\193P\DEL\224\161\RS\GS\248w\175]\205g\225\r>\210}\DEL\196M\ETX\236\184\158\202\223`0D\223\194\210I$I\187\170\171\&3\SOT\ETX\253B\234\255\NUL\240B\191\217\vY\248L|\CAN\255\NUL\179\239\195Ht\191'\201\ETBV\250JC\170\175\CAN\221\246\245\197\214\255\NUL\246\140\164\215\242\149\255\NUL\EOT\157\255\NUL\130\137\235\US\240K\191\219c\195?\NAK\180\219\ETX\172i\246i.\157\173\233a\194\&6\165\167\206\NUL\154\&5c\247\\\DLE\146!\233\190\&5\207\EM\a\250\&3\214\DEL\224\237\159\216\223O\248R\254 \181\241G\139\175\245\143\179\EMS\195i\225\187\148\212ZM\185\DC1\EM\EME\176\&9\227w\156W\190MK\184\US\206g\252\NAK\203\246\SI_\248&\207\252\DC4\ETX\199\223\tm\181\tu]\USC\158\ESC\189\RS\242R<\217\172naK\136\EOT\152\NULy\136\178yl@\NUL\180l@\193\NAK\243m{g\252\DC4O\246\219\215\255\NUL\224\162\DEL\182G\141\190/\248\138\214=>\243\197\151h\214\246\DC1>\248\244\235HcHm\224\r\129\187dQ\160-\129\185\183\&6\SOH5\226u@\DELo?\240I\255\NUL\249E\159\236\211\255\NULd\171\194\255\NUL\250h\181\175\DEL\175\NUL\255\NUL\130O\255\NUL\202,\255\NULf\159\251%^\ETB\255\NUL\211E\173{\253f\SOHE\DC4P\SOHE\DC4P\SOHE\DC4P\SOHE\DC4P\a\228\ETB\252\RS\167\255\NUL(\179\240\SI\253\149];\255\NULM\SUB\197\DEL0\149\253=\255\NUL\193\234\DEL\242\139?\NUL\255\NUL\217U\211\191\244\209\172W\243\n\170]\130\168%\137\192\ETX\189T@\251\239\254\r\194\255\NUL\130n/\252\DC4S\254\n-\161\199\174Y\ESC\175\135\255\NUL\rD~'\241\RS\245\253\213\215\151 \251\&5\155q\131\231L\ACK\229\&8\204Q\205\220W\244\215\255\NUL\ENQQ\255\NUL\130kx?\254\n\147\251$k_\r\188J\176\216\234X\251g\135u\161\by\180+\244\a\203\153{\148o\185\"\STX7#0\224\224\143\DC4\255\NUL\131p\255\NUL\224\155\223\240\238\255\NUL\248'>\128\186\214\157\246?\136_\DC2Bx\151\196\190b\SOH5\185\145\DEL\209m\ESC\140\143&\DC2\160\169\206$\146oZ\251\242\147`\DEL\b\DEL\180\223\236\217\226\255\NUL\217\a\227\199\137\190\ESC\248\243J\155G\241G\132\239^\202\242\a\ak\227\149\150\&6 o\138E*\232\227\134VR:\215\a_\213\167\252\FS\163\255\NUL\EOTF\US\240R/\129\233\241\ESC\225\230\155\DC3|i\240\r\163\b!\137\NUL\147\197:z\229\218\197\143y\144\150xI\238\206\159\198\n\254O\255\NUL\193\SYN\255\NUL\224\217o\136_\183/\196;\173{\227v\133\227?\133_\v\244'h\165\138\246\197\244\221k^\184\FSyV\241\206\153\142\&5<\188\204\132dlPN\226\149p?*\232\175\209/\248\&8\US\254\b\129\&7\252\DC2S\227.\143\170x>mk\\\248?\227%\217\164\234\SUB\129Yn4\219\212\\\203eq\"*\169b\a\153\ESCm]\201\184`\152\216\159\206\218`\DELo?\240I\255\NUL\249E\159\236\211\255\NULd\171\194\255\NUL\250h\181\175\DEL\175\NUL\255\NUL\130O\255\NUL\202,\255\NULf\159\251%^\ETB\255\NUL\211E\173{\253f\SOHE\DC4P\SOHE\DC4P\SOHE\DC4P\SOHE\DC4P\a\228\ETB\252\RS\167\255\NUL(\179\240\SI\253\149];\255\NULM\SUB\197~?\DEL\193\182\255\NUL\240O\187?\248(\a\252\DC4\211\195vz\242\219M\225\US\135\&0\255\NUL\194c\173Z\204\ETX\rA-\229\141`\183\218xe{\137!\222\SI\ACK0\227\184\175\232\203\254\v\201\255\NUL\EOT\216\213?\224\169_\240O\157_\225\255\NUL\135.\173-|a\162\234v\254%\240\239\218\223\203\183\184\188\129%\143\201v\254\DC1$3\204\129\143\n\204\164\240\r\DEL0\154\ETB\252\DC3S\246\213\253\151\190#]K\225\223\131\159\180\ETB\133\252Ef\RS\214K\255\NUL\r\232\154\150\226\164\252\202\183\&6\138U\208\224}\215*p\SI<U-\128\254\209\192\192\162\191\142\159\248W\DEL\240R\SI\250\ETX~\218\US\248\r\226?\240\163\254\NAK\223\252\DC4\131\254\128\223\182\135\254\ETXx\143\252(\229\ETX\251\SYN\162\191\142\159\248W\DEL\240R\SI\250\ETX~\218\US\248\r\226?\240\163\254\NAK\223\252\DC4\131\254\128\223\182\135\254\ETXx\143\252(\229\ETX\250\186\253\186\DELc\SI\a\255\NUL\193@\191e\207\NAK|)\241\197\187I\162\248\154\219dw\DC1\129\231\233\183(wAu\DC1\237$r\ENQa\216\128T\229X\131\252X\254\217\159\178\151\137\191a\239\218\135\198\159\n|^\176\255\NULox/Qk)\165\132\238\138\234\&2\ETX\195:\DEL\179$N\146\NULy\SOH\192\&8 \138\250S\254\NAK\223\252\DC4\131\254\128\223\182\135\254\ETXx\143\252*O\217\175\254\ba\251]\254\222\DEL\180e\173\159\137>\FS\252H\240\231\246\213\226\201\174\248\183\199\SUB}\213\148v\177\DC2<\201\222K\160\178N\225G\b\155\153\142\a\ETX$\v@?\169?\248$\255\NUL\252\162\207\246i\255\NUL\178U\225\DEL\253\&4Z\215\191\215/\240?\225.\151\240\v\224\183\131\252\v\162\t\ETBE\240V\137e\160\216\a?0\183\181\129 \143>\251#Z\234*@(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL\255\217"
mockFetchProductImageV1 _ _ = return $ Just $ BL.pack "\255\216\255\224\NUL\DLEJFIF\NUL\SOH\SOH\NUL\NUL\SOH\NUL\SOH\NUL\NUL\255\254\NUL>CREATOR: gd-jpeg v1.0 (using IJG JPEG v62), default quality\n\255\219\NULC\NUL\b\ACK\ACK\a\ACK\ENQ\b\a\a\a\t\t\b\n\f\DC4\r\f\v\v\f\EM\DC2\DC3\SI\DC4\GS\SUB\US\RS\GS\SUB\FS\FS $.' \",#\FS\FS(7),01444\US'9=82<.342\255\219\NULC\SOH\t\t\t\f\v\f\CAN\r\r\CAN2!\FS!22222222222222222222222222222222222222222222222222\255\192\NUL\DC1\b\NUL\135\NUL\135\ETX\SOH\"\NUL\STX\DC1\SOH\ETX\DC1\SOH\255\196\NUL\US\NUL\NUL\SOH\ENQ\SOH\SOH\SOH\SOH\SOH\SOH\NUL\NUL\NUL\NUL\NUL\NUL\NUL\NUL\SOH\STX\ETX\EOT\ENQ\ACK\a\b\t\n\v\255\196\NUL\181\DLE\NUL\STX\SOH\ETX\ETX\STX\EOT\ETX\ENQ\ENQ\EOT\EOT\NUL\NUL\SOH}\SOH\STX\ETX\NUL\EOT\DC1\ENQ\DC2!1A\ACK\DC3Qa\a\"q\DC42\129\145\161\b#B\177\193\NAKR\209\240$3br\130\t\n\SYN\ETB\CAN\EM\SUB%&'()*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz\131\132\133\134\135\136\137\138\146\147\148\149\150\151\152\153\154\162\163\164\165\166\167\168\169\170\178\179\180\181\182\183\184\185\186\194\195\196\197\198\199\200\201\202\210\211\212\213\214\215\216\217\218\225\226\227\228\229\230\231\232\233\234\241\242\243\244\245\246\247\248\249\250\255\196\NUL\US\SOH\NUL\ETX\SOH\SOH\SOH\SOH\SOH\SOH\SOH\SOH\SOH\NUL\NUL\NUL\NUL\NUL\NUL\SOH\STX\ETX\EOT\ENQ\ACK\a\b\t\n\v\255\196\NUL\181\DC1\NUL\STX\SOH\STX\EOT\EOT\ETX\EOT\a\ENQ\EOT\EOT\NUL\SOH\STXw\NUL\SOH\STX\ETX\DC1\EOT\ENQ!1\ACK\DC2AQ\aaq\DC3\"2\129\b\DC4B\145\161\177\193\t#3R\240\NAKbr\209\n\SYN$4\225%\241\ETB\CAN\EM\SUB&'()*56789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz\130\131\132\133\134\135\136\137\138\146\147\148\149\150\151\152\153\154\162\163\164\165\166\167\168\169\170\178\179\180\181\182\183\184\185\186\194\195\196\197\198\199\200\201\202\210\211\212\213\214\215\216\217\218\226\227\228\229\230\231\232\233\234\242\243\244\245\246\247\248\249\250\255\218\NUL\f\ETX\SOH\NUL\STX\DC1\ETX\DC1\NUL?\NUL\247\250)(\160\ENQ\162\146\138\NULZ\142i|\165\a\EM\201\197>\171_g\236\196\175Px\161\129\f\154\180q\156\&2\DC1\248\212g[\132\DEL\203\&7\172\251\137-\236\225\&3\\:\170\142\172\213\207\\\248\194\222\ETBa\ENQ\171\&8Q\157\204q\159\194\179s\182\229\168\223c\174\254\223\132\244\141\191:r\235q1\199\150\223_\242+\206\135\141.\228\144\&3\218\192\171\253\220\DC3\253k^\219\196\240O\STX\176\128$\164\240\&3\128O\214\165UO\169N\155Gf\186\154\177\225\t\252j\204W1\201\129\156\&1\237X\144\200\178\133\144\FS\SUB\210\180\230E\252kD\204\218\&4(\164\162\168B\209E%\NUL-\DC4\148P\SOHE\DC4\180\NUL\148R\209@\tP\222\DEL\199\164\135\EM\192\205OP\221\SI\244Y\DEL\220\&40<\171\\\190\146\250\232\180\156F\132\133N\203X\229\219\CANf%{\138\187\168\ENQ[\203\128\185\b\\\224\SUB\133\DLE\140\198\DC3s\SUB\224\147m\157\138\201\NAKHR8\CAN\247\169-\238<\134\220G\200x#\252(\149\&03\183\156\224\138\140\171\&0\218\DC4\182O\165d\238\153j\204\233,o.R\246\221\227\144\155v\249H\GS+\208\180\224Xn?\221\253My\238\129\a\239B\RS{\156\215\164X\174-\201\GS\216\215m\ETBuvr\213\209\150h\165\162\183\&2\nJZ(\SOH(\165\162\128\n)(\160\ENQ\162\146\138\NULZ\138\227\254=\165\255\NULp\255\NUL*\146\171^\206\144\192Cg\231\ENQF=q@\RSG\172a5)\147\ETX\EOT\147M\181\149\226+,dd\fr3\154_\DC2\DC3\SO\166\229\149\148\&7BF3\244\245\170\t#\197\CANc\187i\EM\FSu\174\rT\142\205\226Y\148\&3o\145\190\251\242q\235K\ETXp;\RS\249\237P#\180\170N\b\CAN\239OBTu\224\243Y\201\221\220\164u\RS\RS\SOH\174\&7\SOH\220\SI\243\249W\160Y\fY\199\238\&3^}\225\199\RSZ0\254'#\244\NAK\232\150\203\182\218!\232\131\249Wm\SI\132\229\171\241\DC2\209IElf-\DC4RP\STX\209IE\NUL-%\DC4\180\NULQE\DC4\NULVf\177\254\166/\247\171N\179\&5\143\245\&1\DEL\188h`bM\EOT7\DC1\152\230\141$C\213\\dV5\223\134\160\151-m!\136\159\224o\153O\245\NAK\187M\168qOq\169\&5\177\194]i7zr\179<M\183\187\167\204\191\167#\241\170\n\v\f\131\149\199^\213\233$\129\212\214}\230\137cz\173\152\252\167a\130\241\252\167\241\236k\EMQ\190\198\177\171\220\205\240\220\155\196J\a\SOH\156\254\130\189\&5\ACK#Q\232\ENQp:N\146\250\\\133|\209$\DEL\194q\130\&8\239]\242\178\178\130\164\DC1\234+JQj6dM\166\238\135QE\NAK\169\SOHIKE\NUL\DC4QE\NUL\DC4RQ@\vE%\DC4\NUL\181\141\226\NAKf\130\r\155r\FS\157\173\209\184\173\154\195\241\&5\196v\214qI*\238]\254\153\237I\187-@\199\134c!\n\160F\STX\231\a\235\252\170%\150H\162\\\DLEA\223\193\GS1\147D\ETB\150\247K\148\193+\216\142Er\247~=\134\210\250x\SUB\192\188q9@\202\195'\DC4\210\190\194:\135\153\183\170>\198\201F\EM\GS2ic\150M\161U\193vs\212t\EM\235\\\204^9\209\167\184\r,\211@@\193S\RSq\249\n\218Ym\216\198\209J\238\146\STX\192\&1\193\US\152\207\173L\218\130\187\SUB\139{\ETB>\213!\141\221q\242\228\DLE{zWO\162\238\251\ACKX\130K\158\149\200\219\180\ETB \132wW\fws\158s\200\244\174\183C]\154b.\230l\DC277SDZj\232\SUBi\217\154TRQT\STX\209E%\NUL-\DC4\148P\STX\209G\DC4P\SOHE\DC4q@\ENQr\222:r\186\&2c\169c\206z\fs]Ms\222-\178[\219\CAN\DC1\134v\201\184s\237Y\213\139\148\SUB\142\229E\164\238\207\&5\148\223i\186+j\251\131M\fe\130t\202u \251\240+\205\236\174a\185\138i\238\229\148JX\176@q\188\245\235\254z\215\165k:~\175%\132\214\251\210\239\206`\177\196YUN\ACKpH\232\NUL\231\240\174:\207\195f\ESCh\174\238\236a\DEL\157\145\204Rl\220\197\246\175\EM9\249\129\FS\SOH\199n\245\197\132U\168\198J\163\190\191\161\180\249f\213\186\150|=\225\219\219\187A\171\195\229\ETX\FS\128\197\v\255\NUL\203@:\243\219\218\186\251F\142\238'\133B\197\SUB\141\190X]\175\ESC{\255\NUL\159J\170\150\ETB6\214\178-\146[Y\205\EM\SOH\147\205\ESC\t###\208\245\205U\DC1_\197\&3\207p\240\163\196\203\DC4\237\DC3\238\bX\224\ETX\211=G\211p\168\173\&9I\243Ih\141\160\163\b\252E\237\&3Phf}>wqsn\193\149\152\225\165F$\131\207\167 \215\169\248z_;IG\245c^(\154;\203\227\&8/\166\212\161\148\188n\177\198\145\237X\192\NUL`|\220\156\DC3^\203\225U)\161F\172A!\216dt5\213\131\156%J\241w\185\201Rj\163\230\142\198\221\DC4Q\197u\DLE\DC4Q\197\DC4\NULQG\DC4P\STXQKE\NUL%\DC4\180P\STXW3\227k\217lt\184e\133A\DEL0\240G\USt\158k\167\174w\197\165\254\201j\169\128ZR\v\DELw\229<\208\213\192\241\253k\198\151m\162\196\214\197a\186w*\197P|\188rFs\244\169\188\&9>\167\169h\211]^\188\DEL4\187\161e\137A\206\226\228\244\254\255\NUL?QX\254\&2\178\141\&5\200\160\137>s\SUB\130\DLEuc\237\235]\164V\191\217\218=\165\145#(\138\173\143^\245\203\137\147\132ROSz\DC1M\156\212\183\ETB\233\&7\149q|\183\DLE\176Q\251\216\128q\180\&6\211\149\198~\241\244\172\219\223\DC1O\DEL}s`\238\237o9\242\166\141\"_\226\EOT1'\166I\t\143Lq\205[\215f\142\202\EM\167P\249\141K.H\193\237\252\202\143\198\177\180\143\f\\\193\b\188\214ue\177\243\152I\229\DEL\SYNs\159\155\144\SOH\246\231\240\174hF\237\206\164\172kY\197$\162\138W2Y\233Z\130\218X\164\144\192P\t\EM8\145\219#\248\143\&8\246\FSW\208\US\f\SYNe\240\\+p\\\186\205 \249\243\156\ETX\142\245\230\159\240\140\taK\143\181E\DEL\DC2\156\137\RS1\184\SO9'\156\253k\215|\CAN\165|;\DC1#\ESC\156\182>\181\215B+\149\&4\239\231\185\141J\137\171#\160\164\165\162\186\fB\146\150\138\NULJ)h\160\STX\138JZ\NUL(\162\146\128\SYN\176|N\CAN\219\218\224\128\EOT\223\&6}6\154\222\172_\DC1\143\244{oi\DEL\246S@\RS;in5_\RS\220\220\183\&0\218\146\192\250\145\194\255\NUL\143\225Z\154\181\228x\DEL,\129(`_\a\141\192z~U5\178\233\200\215\215\182\176\203\DC3\DLE\165\208\DLECd\224}*+\229\133\160V\144\&2\130\206\184\237\149<\224\215\SO&\157Y\207\221\216\234\161R\156V\167%%\241\188\241\SO\151\165J\227l\178\249\206\129@\ah%A\250\176\253*\207\137\239?\179\146)\238\244\235[\165}\241\175\152rU\143L\130\&1\140\SI\235R^x'P\159ZMR\219(P\171BT\242\184\228\FS}k\164\190\208l\188E\DC4Q\234\150\146\219\220\169\a|c\130q\252\190\181\157\\\FS\166\160\251n\189H\149T\230\217\201\252>\213\&5+\141N\r>WY,\227\140\160}\132\ACKP0\a=\186{\215\182\248)\247\248uzq,\131\245\174.\203J\211\180\180\217f\140\EM\SOHM\219\&1\142\196\253}\235\189\240\204\vo\164\EOTA\180\EM\CAN\227\235]\148)\242'\165\174\246\&1\147\187\&6h\162\146\182\DLE\180RQ@\vE%\DC4\NULQE\DC4\NUL\180\148Q@\vU\174\236\227\188DY\v\NUL\167p\198(\162\128)\141\STX\208\ACK\NUL\176\r\212`s\250R\US\SI\218\NAK\v\150\218:\STX\ACK\a\233E\DC4\NUL\191\216p\DEL\207G\253)\223\216\150\255\NUL\243\210O\211\252(\162\128\">\FS\178g\SOZm\195\&8;\171F\218\217-b\242\208\177\EM\207\205E\DC4\SOH=\DC4Q@\ENQ\DC4Q@\ENQ\DC4Q@\US\255\217"

mockFetchProductImageV2 :: V2.FetchProductImage
mockFetchProductImageV2 _ "BT470" = return $ Just $ BL.pack "\255\216\255\224\NUL\DLEJFIF\NUL\SOH\SOH\SOH\NUL\165\NUL\165\NUL\NUL\255\225\NUL\138Exif\NUL\NULMM\NUL*\NUL\NUL\NUL\b\NUL\a\SOH\SUB\NUL\ENQ\NUL\NUL\NUL\SOH\NUL\NUL\NULb\SOH\ESC\NUL\ENQ\NUL\NUL\NUL\SOH\NUL\NUL\NULj\SOH(\NUL\ETX\NUL\NUL\NUL\SOH\NUL\ETX\NUL\NUL\SOH1\NUL\STX\NUL\NUL\NUL\DLE\NUL\NUL\NULrQ\DLE\NUL\SOH\NUL\NUL\NUL\SOH\SOH\NUL\NUL\NULQ\DC1\NUL\EOT\NUL\NUL\NUL\SOH\NUL\NUL\EMNQ\DC2\NUL\EOT\NUL\NUL\NUL\SOH\NUL\NUL\EMN\NUL\NUL\NUL\NUL\NUL\NUL\253\v\NUL\NUL\ETX\232\NUL\NUL\253\v\NUL\NUL\ETX\232paint.net 4.1.5\NUL\255\219\NULC\NUL\STX\SOH\SOH\STX\SOH\SOH\STX\STX\STX\STX\STX\STX\STX\STX\ETX\ENQ\ETX\ETX\ETX\ETX\ETX\ACK\EOT\EOT\ETX\ENQ\a\ACK\a\a\a\ACK\a\a\b\t\v\t\b\b\n\b\a\a\n\r\n\n\v\f\f\f\f\a\t\SO\SI\r\f\SO\v\f\f\f\255\219\NULC\SOH\STX\STX\STX\ETX\ETX\ETX\ACK\ETX\ETX\ACK\f\b\a\b\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\f\255\192\NUL\DC1\b\NUL\135\NUL\135\ETX\SOH\"\NUL\STX\DC1\SOH\ETX\DC1\SOH\255\196\NUL\US\NUL\NUL\SOH\ENQ\SOH\SOH\SOH\SOH\SOH\SOH\NUL\NUL\NUL\NUL\NUL\NUL\NUL\NUL\SOH\STX\ETX\EOT\ENQ\ACK\a\b\t\n\v\255\196\NUL\181\DLE\NUL\STX\SOH\ETX\ETX\STX\EOT\ETX\ENQ\ENQ\EOT\EOT\NUL\NUL\SOH}\SOH\STX\ETX\NUL\EOT\DC1\ENQ\DC2!1A\ACK\DC3Qa\a\"q\DC42\129\145\161\b#B\177\193\NAKR\209\240$3br\130\t\n\SYN\ETB\CAN\EM\SUB%&'()*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz\131\132\133\134\135\136\137\138\146\147\148\149\150\151\152\153\154\162\163\164\165\166\167\168\169\170\178\179\180\181\182\183\184\185\186\194\195\196\197\198\199\200\201\202\210\211\212\213\214\215\216\217\218\225\226\227\228\229\230\231\232\233\234\241\242\243\244\245\246\247\248\249\250\255\196\NUL\US\SOH\NUL\ETX\SOH\SOH\SOH\SOH\SOH\SOH\SOH\SOH\SOH\NUL\NUL\NUL\NUL\NUL\NUL\SOH\STX\ETX\EOT\ENQ\ACK\a\b\t\n\v\255\196\NUL\181\DC1\NUL\STX\SOH\STX\EOT\EOT\ETX\EOT\a\ENQ\EOT\EOT\NUL\SOH\STXw\NUL\SOH\STX\ETX\DC1\EOT\ENQ!1\ACK\DC2AQ\aaq\DC3\"2\129\b\DC4B\145\161\177\193\t#3R\240\NAKbr\209\n\SYN$4\225%\241\ETB\CAN\EM\SUB&'()*56789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz\130\131\132\133\134\135\136\137\138\146\147\148\149\150\151\152\153\154\162\163\164\165\166\167\168\169\170\178\179\180\181\182\183\184\185\186\194\195\196\197\198\199\200\201\202\210\211\212\213\214\215\216\217\218\226\227\228\229\230\231\232\233\234\242\243\244\245\246\247\248\249\250\255\218\NUL\f\ETX\SOH\NUL\STX\DC1\ETX\DC1\NUL?\NUL\253\252\162\138(\NUL\162\138(\NUL\162\138(\NUL\162\138(\NUL\162\138(\NUL\162\138(\NUL\162\138(\NUL\162\138(\NUL\162\138(\NUL\162\138(\NUL\162\138(\NUL\162\138(\NUL\162\138(\NUL\162\138(\NUL\162\138(\NUL\162\138(\NUL\162\138(\NUL\162\138(\NUL\162\138(\NUL\162\138(\NUL\175\159\252g\255\NUL\ENQ\\\253\153~\GS\248\150\239G\215>>\252\"\210\245K\t\SUB\ESC\155Y\252Uf\178\192\234p\202\195\204\225\129\EOT\DLEy\ACK\190N\255\NUL\131\177?j\175\SYN~\203\DEL\240J)\151\193\250\149\230\143}\241\DC3\197V^\DC1\187\189\180\148\195q\ENQ\164\182\215wS\EOTu\228y\139i\229\FSuY\CANw\175\228\226\169+\129\253\178\DEL\195\228\191d\255\NUL\250\&8\207\131?\248VY\255\NUL\241\202?\225\242_\178\DEL\253\FSg\193\159\252+,\255\NUL\248\229\DEL\DC3tQ\202\a\246\201\255\NUL\SI\146\253\147\255\NUL\232\227>\f\255\NUL\225Yg\255\NUL\199(\255\NUL\135\201~\201\255\NUL\244q\159\ACK\DEL\240\172\179\255\NUL\227\149\252M\209G(\US\219'\252>K\246O\255\NUL\163\140\248\&3\255\NUL\133e\159\255\NUL\FS\174\239\224O\237\229\240O\246\160\241\EOT\186O\195\159\139\US\SI|o\171C\EM\153\236\180]z\218\242\225Puo-\FS\182\209\220\227\STX\191\134\n\222\248[\241G\196?\EOT\254\"\232\190.\240\158\175}\160\248\147\195\183q\223i\218\133\156\166)\237fC\149ea\249\DC1\208\130A\200&\142P?\189\170+\205\DELc/\141\ETB\DEL\180\135\236}\240\167\226%\253\188v\183\222=\240v\145\226;\136c\251\176\201ye\r\195(\246\r!\US\133zUH\ENQ\DC4Q@\ENQ\DC4Q@\ENQ\DC4Q@\ENQ\DC4Q@\US\144_\240z\159\252\162\207\192?\246Ut\239\253\&4k\NAK\252\194W\244\247\255\NUL\a\169\255\NUL\202,\252\ETX\255\NULeWN\255\NUL\211F\177_\204%T@(\162\189C\246\145\253\138\190+\254\200\DLExf_\137\222\ETX\241\ETB\130\227\241\149\128\212\244f\212\173\252\177}\SOH\198J\156\156\&0\220\187\163l:\238]\202\&23@{\151\252\DLE\199\254\t\199\167\255\NUL\193P\DEL\224\161\RS\GS\248w\175]\205g\225\r>\210}\DEL\196M\ETX\236\184\158\202\223`0D\223\194\210I$I\187\170\171\&3\SOT\ETX\253B\234\255\NUL\240B\191\217\vY\248L|\CAN\255\NUL\179\239\195Ht\191'\201\ETBV\250JC\170\175\CAN\221\246\245\197\214\255\NUL\246\140\164\215\242\149\255\NUL\EOT\157\255\NUL\130\137\235\US\240K\191\219c\195?\NAK\180\219\ETX\172i\246i.\157\173\233a\194\&6\165\167\206\NUL\154\&5c\247\\\DLE\146!\233\190\&5\207\EM\a\250\&3\214\DEL\224\237\159\216\223O\248R\254 \181\241G\139\175\245\143\179\EMS\195i\225\187\148\212ZM\185\DC1\EM\EME\176\&9\227w\156W\190MK\184\US\206g\252\NAK\203\246\SI_\248&\207\252\DC4\ETX\199\223\tm\181\tu]\USC\158\ESC\189\RS\242R<\217\172naK\136\EOT\152\NULy\136\178yl@\NUL\180l@\193\NAK\243m{g\252\DC4O\246\219\215\255\NUL\224\162\DEL\182G\141\190/\248\138\214=>\243\197\151h\214\246\DC1>\248\244\235HcHm\224\r\129\187dQ\160-\129\185\183\&6\SOH5\226u@\DELo?\240I\255\NUL\249E\159\236\211\255\NULd\171\194\255\NUL\250h\181\175\DEL\175\NUL\255\NUL\130O\255\NUL\202,\255\NULf\159\251%^\ETB\255\NUL\211E\173{\253f\SOHE\DC4P\SOHE\DC4P\SOHE\DC4P\SOHE\DC4P\a\228\ETB\252\RS\167\255\NUL(\179\240\SI\253\149];\255\NULM\SUB\197\DEL0\149\253=\255\NUL\193\234\DEL\242\139?\NUL\255\NUL\217U\211\191\244\209\172W\243\n\170]\130\168%\137\192\ETX\189T@\251\239\254\r\194\255\NUL\130n/\252\DC4S\254\n-\161\199\174Y\ESC\175\135\255\NUL\rD~'\241\RS\245\253\213\215\151 \251\&5\155q\131\231L\ACK\229\&8\204Q\205\220W\244\215\255\NUL\ENQQ\255\NUL\130kx?\254\n\147\251$k_\r\188J\176\216\234X\251g\135u\161\by\180+\244\a\203\153{\148o\185\"\STX7#0\224\224\143\DC4\255\NUL\131p\255\NUL\224\155\223\240\238\255\NUL\248'>\128\186\214\157\246?\136_\DC2Bx\151\196\190b\SOH5\185\145\DEL\209m\ESC\140\143&\DC2\160\169\206$\146oZ\251\242\147`\DEL\b\DEL\180\223\236\217\226\255\NUL\217\a\227\199\137\190\ESC\248\243J\155G\241G\132\239^\202\242\a\ak\227\149\150\&6 o\138E*\232\227\134VR:\215\a_\213\167\252\FS\163\255\NUL\EOTF\US\240R/\129\233\241\ESC\225\230\155\DC3|i\240\r\163\b!\137\NUL\147\197:z\229\218\197\143y\144\150xI\238\206\159\198\n\254O\255\NUL\193\SYN\255\NUL\224\217o\136_\183/\196;\173{\227v\133\227?\133_\v\244'h\165\138\246\197\244\221k^\184\FSyV\241\206\153\142\&5<\188\204\132dlPN\226\149p?*\232\175\209/\248\&8\US\254\b\129\&7\252\DC2S\227.\143\170x>mk\\\248?\227%\217\164\234\SUB\129Yn4\219\212\\\203eq\"*\169b\a\153\ESCm]\201\184`\152\216\159\206\218`\DELo?\240I\255\NUL\249E\159\236\211\255\NULd\171\194\255\NUL\250h\181\175\DEL\175\NUL\255\NUL\130O\255\NUL\202,\255\NULf\159\251%^\ETB\255\NUL\211E\173{\253f\SOHE\DC4P\SOHE\DC4P\SOHE\DC4P\SOHE\DC4P\a\228\ETB\252\RS\167\255\NUL(\179\240\SI\253\149];\255\NULM\SUB\197~?\DEL\193\182\255\NUL\240O\187?\248(\a\252\DC4\211\195vz\242\219M\225\US\135\&0\255\NUL\194c\173Z\204\ETX\rA-\229\141`\183\218xe{\137!\222\SI\ACK0\227\184\175\232\203\254\v\201\255\NUL\EOT\216\213?\224\169_\240O\157_\225\255\NUL\135.\173-|a\162\234v\254%\240\239\218\223\203\183\184\188\129%\143\201v\254\DC1$3\204\129\143\n\204\164\240\r\DEL0\154\ETB\252\DC3S\246\213\253\151\190#]K\225\223\131\159\180\ETB\133\252Ef\RS\214K\255\NUL\r\232\154\150\226\164\252\202\183\&6\138U\208\224}\215*p\SI<U-\128\254\209\192\192\162\191\142\159\248W\DEL\240R\SI\250\ETX~\218\US\248\r\226?\240\163\254\NAK\223\252\DC4\131\254\128\223\182\135\254\ETXx\143\252(\229\ETX\251\SYN\162\191\142\159\248W\DEL\240R\SI\250\ETX~\218\US\248\r\226?\240\163\254\NAK\223\252\DC4\131\254\128\223\182\135\254\ETXx\143\252(\229\ETX\250\186\253\186\DELc\SI\a\255\NUL\193@\191e\207\NAK|)\241\197\187I\162\248\154\219dw\DC1\129\231\233\183(wAu\DC1\237$r\ENQa\216\128T\229X\131\252X\254\217\159\178\151\137\191a\239\218\135\198\159\n|^\176\255\NULox/Qk)\165\132\238\138\234\&2\ETX\195:\DEL\179$N\146\NULy\SOH\192\&8 \138\250S\254\NAK\223\252\DC4\131\254\128\223\182\135\254\ETXx\143\252*O\217\175\254\ba\251]\254\222\DEL\180e\173\159\137>\FS\252H\240\231\246\213\226\201\174\248\183\199\SUB}\213\148v\177\DC2<\201\222K\160\178N\225G\b\155\153\142\a\ETX$\v@?\169?\248$\255\NUL\252\162\207\246i\255\NUL\178U\225\DEL\253\&4Z\215\191\215/\240?\225.\151\240\v\224\183\131\252\v\162\t\ETBE\240V\137e\160\216\a?0\183\181\129 \143>\251#Z\234*@(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL(\162\138\NUL\255\217"
mockFetchProductImageV2 _ _ = return $ Just $ BL.pack "\255\216\255\224\NUL\DLEJFIF\NUL\SOH\SOH\NUL\NUL\SOH\NUL\SOH\NUL\NUL\255\254\NUL>CREATOR: gd-jpeg v1.0 (using IJG JPEG v62), default quality\n\255\219\NULC\NUL\b\ACK\ACK\a\ACK\ENQ\b\a\a\a\t\t\b\n\f\DC4\r\f\v\v\f\EM\DC2\DC3\SI\DC4\GS\SUB\US\RS\GS\SUB\FS\FS $.' \",#\FS\FS(7),01444\US'9=82<.342\255\219\NULC\SOH\t\t\t\f\v\f\CAN\r\r\CAN2!\FS!22222222222222222222222222222222222222222222222222\255\192\NUL\DC1\b\NUL\135\NUL\135\ETX\SOH\"\NUL\STX\DC1\SOH\ETX\DC1\SOH\255\196\NUL\US\NUL\NUL\SOH\ENQ\SOH\SOH\SOH\SOH\SOH\SOH\NUL\NUL\NUL\NUL\NUL\NUL\NUL\NUL\SOH\STX\ETX\EOT\ENQ\ACK\a\b\t\n\v\255\196\NUL\181\DLE\NUL\STX\SOH\ETX\ETX\STX\EOT\ETX\ENQ\ENQ\EOT\EOT\NUL\NUL\SOH}\SOH\STX\ETX\NUL\EOT\DC1\ENQ\DC2!1A\ACK\DC3Qa\a\"q\DC42\129\145\161\b#B\177\193\NAKR\209\240$3br\130\t\n\SYN\ETB\CAN\EM\SUB%&'()*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz\131\132\133\134\135\136\137\138\146\147\148\149\150\151\152\153\154\162\163\164\165\166\167\168\169\170\178\179\180\181\182\183\184\185\186\194\195\196\197\198\199\200\201\202\210\211\212\213\214\215\216\217\218\225\226\227\228\229\230\231\232\233\234\241\242\243\244\245\246\247\248\249\250\255\196\NUL\US\SOH\NUL\ETX\SOH\SOH\SOH\SOH\SOH\SOH\SOH\SOH\SOH\NUL\NUL\NUL\NUL\NUL\NUL\SOH\STX\ETX\EOT\ENQ\ACK\a\b\t\n\v\255\196\NUL\181\DC1\NUL\STX\SOH\STX\EOT\EOT\ETX\EOT\a\ENQ\EOT\EOT\NUL\SOH\STXw\NUL\SOH\STX\ETX\DC1\EOT\ENQ!1\ACK\DC2AQ\aaq\DC3\"2\129\b\DC4B\145\161\177\193\t#3R\240\NAKbr\209\n\SYN$4\225%\241\ETB\CAN\EM\SUB&'()*56789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz\130\131\132\133\134\135\136\137\138\146\147\148\149\150\151\152\153\154\162\163\164\165\166\167\168\169\170\178\179\180\181\182\183\184\185\186\194\195\196\197\198\199\200\201\202\210\211\212\213\214\215\216\217\218\226\227\228\229\230\231\232\233\234\242\243\244\245\246\247\248\249\250\255\218\NUL\f\ETX\SOH\NUL\STX\DC1\ETX\DC1\NUL?\NUL\247\250)(\160\ENQ\162\146\138\NULZ\142i|\165\a\EM\201\197>\171_g\236\196\175Px\161\129\f\154\180q\156\&2\DC1\248\212g[\132\DEL\203\&7\172\251\137-\236\225\&3\\:\170\142\172\213\207\\\248\194\222\ETBa\ENQ\171\&8Q\157\204q\159\194\179s\182\229\168\223c\174\254\223\132\244\141\191:r\235q1\199\150\223_\242+\206\135\141.\228\144\&3\218\192\171\253\220\DC3\253k^\219\196\240O\STX\176\128$\164\240\&3\128O\214\165UO\169N\155Gf\186\154\177\225\t\252j\204W1\201\129\156\&1\237X\144\200\178\133\144\FS\SUB\210\180\230E\252kD\204\218\&4(\164\162\168B\209E%\NUL-\DC4\148P\SOHE\DC4\180\NUL\148R\209@\tP\222\DEL\199\164\135\EM\192\205OP\221\SI\244Y\DEL\220\&40<\171\\\190\146\250\232\180\156F\132\133N\203X\229\219\CANf%{\138\187\168\ENQ[\203\128\185\b\\\224\SUB\133\DLE\140\198\DC3s\SUB\224\147m\157\138\201\NAKHR8\CAN\247\169-\238<\134\220G\200x#\252(\149\&03\183\156\224\138\140\171\&0\218\DC4\182O\165d\238\153j\204\233,o.R\246\221\227\144\155v\249H\GS+\208\180\224Xn?\221\253My\238\129\a\239B\RS{\156\215\164X\174-\201\GS\216\215m\ETBuvr\213\209\150h\165\162\183\&2\nJZ(\SOH(\165\162\128\n)(\160\ENQ\162\146\138\NULZ\138\227\254=\165\255\NULp\255\NUL*\146\171^\206\144\192Cg\231\ENQF=q@\RSG\172a5)\147\ETX\EOT\147M\181\149\226+,dd\fr3\154_\DC2\DC3\SO\166\229\149\148\&7BF3\244\245\170\t#\197\CANc\187i\EM\FSu\174\rT\142\205\226Y\148\&3o\145\190\251\242q\235K\ETXp;\RS\249\237P#\180\170N\b\CAN\239OBTu\224\243Y\201\221\220\164u\RS\RS\SOH\174\&7\SOH\220\SI\243\249W\160Y\fY\199\238\&3^}\225\199\RSZ0\254'#\244\NAK\232\150\203\182\218!\232\131\249Wm\SI\132\229\171\241\DC2\209IElf-\DC4RP\STX\209IE\NUL-%\DC4\180\NULQE\DC4\NULVf\177\254\166/\247\171N\179\&5\143\245\&1\DEL\188h`bM\EOT7\DC1\152\230\141$C\213\\dV5\223\134\160\151-m!\136\159\224o\153O\245\NAK\187M\168qOq\169\&5\177\194]i7zr\179<M\183\187\167\204\191\167#\241\170\n\v\f\131\149\199^\213\233$\129\212\214}\230\137cz\173\152\252\167a\130\241\252\167\241\236k\EMQ\190\198\177\171\220\205\240\220\155\196J\a\SOH\156\254\130\189\&5\ACK#Q\232\ENQp:N\146\250\\\133|\209$\DEL\194q\130\&8\239]\242\178\178\130\164\DC1\234+JQj6dM\166\238\135QE\NAK\169\SOHIKE\NUL\DC4QE\NUL\DC4RQ@\vE%\DC4\NUL\181\141\226\NAKf\130\r\155r\FS\157\173\209\184\173\154\195\241\&5\196v\214qI*\238]\254\153\237I\187-@\199\134c!\n\160F\STX\231\a\235\252\170%\150H\162\\\DLEA\223\193\GS1\147D\ETB\150\247K\148\193+\216\142Er\247~=\134\210\250x\SUB\192\188q9@\202\195'\DC4\210\190\194:\135\153\183\170>\198\201F\EM\GS2ic\150M\161U\193vs\212t\EM\235\\\204^9\209\167\184\r,\211@@\193S\RSq\249\n\218Ym\216\198\209J\238\146\STX\192\&1\193\US\152\207\173L\218\130\187\SUB\139{\ETB>\213!\141\221q\242\228\DLE{zWO\162\238\251\ACKX\130K\158\149\200\219\180\ETB \132wW\fws\158s\200\244\174\183C]\154b.\230l\DC277SDZj\232\SUBi\217\154TRQT\STX\209E%\NUL-\DC4\148P\STX\209G\DC4P\SOHE\DC4q@\ENQr\222:r\186\&2c\169c\206z\fs]Ms\222-\178[\219\CAN\DC1\134v\201\184s\237Y\213\139\148\SUB\142\229E\164\238\207\&5\148\223i\186+j\251\131M\fe\130t\202u \251\240+\205\236\174a\185\138i\238\229\148JX\176@q\188\245\235\254z\215\165k:~\175%\132\214\251\210\239\206`\177\196YUN\ACKpH\232\NUL\231\240\174:\207\195f\ESCh\174\238\236a\DEL\157\145\204Rl\220\197\246\175\EM9\249\129\FS\SOH\199n\245\197\132U\168\198J\163\190\191\161\180\249f\213\186\150|=\225\219\219\187A\171\195\229\ETX\FS\128\197\v\255\NUL\203@:\243\219\218\186\251F\142\238'\133B\197\SUB\141\190X]\175\ESC{\255\NUL\159J\170\150\ETB6\214\178-\146[Y\205\EM\SOH\147\205\ESC\t###\208\245\205U\DC1_\197\&3\207p\240\163\196\203\DC4\237\DC3\238\bX\224\ETX\211=G\211p\168\173\&9I\243Ih\141\160\163\b\252E\237\&3Phf}>wqsn\193\149\152\225\165F$\131\207\167 \215\169\248z_;IG\245c^(\154;\203\227\&8/\166\212\161\148\188n\177\198\145\237X\192\NUL`|\220\156\DC3^\203\225U)\161F\172A!\216dt5\213\131\156%J\241w\185\201Rj\163\230\142\198\221\DC4Q\197u\DLE\DC4Q\197\DC4\NULQG\DC4P\STXQKE\NUL%\DC4\180P\STXW3\227k\217lt\184e\133A\DEL0\240G\USt\158k\167\174w\197\165\254\201j\169\128ZR\v\DELw\229<\208\213\192\241\253k\198\151m\162\196\214\197a\186w*\197P|\188rFs\244\169\188\&9>\167\169h\211]^\188\DEL4\187\161e\137A\206\226\228\244\254\255\NUL?QX\254\&2\178\141\&5\200\160\137>s\SUB\130\DLEuc\237\235]\164V\191\217\218=\165\145#(\138\173\143^\245\203\137\147\132ROSz\DC1M\156\212\183\ETB\233\&7\149q|\183\DLE\176Q\251\216\128q\180\&6\211\149\198~\241\244\172\219\223\DC1O\DEL}s`\238\237o9\242\166\141\"_\226\EOT1'\166I\t\143Lq\205[\215f\142\202\EM\167P\249\141K.H\193\237\252\202\143\198\177\180\143\f\\\193\b\188\214ue\177\243\152I\229\DEL\SYNs\159\155\144\SOH\246\231\240\174hF\237\206\164\172kY\197$\162\138W2Y\233Z\130\218X\164\144\192P\t\EM8\145\219#\248\143\&8\246\FSW\208\US\f\SYNe\240\\+p\\\186\205 \249\243\156\ETX\142\245\230\159\240\140\taK\143\181E\DEL\DC2\156\137\RS1\184\SO9'\156\253k\215|\CAN\165|;\DC1#\ESC\156\182>\181\215B+\149\&4\239\231\185\141J\137\171#\160\164\165\162\186\fB\146\150\138\NULJ)h\160\STX\138JZ\NUL(\162\146\128\SYN\176|N\CAN\219\218\224\128\EOT\223\&6}6\154\222\172_\DC1\143\244{oi\DEL\246S@\RS;in5_\RS\220\220\183\&0\218\146\192\250\145\194\255\NUL\143\225Z\154\181\228x\DEL,\129(`_\a\141\192z~U5\178\233\200\215\215\182\176\203\DC3\DLE\165\208\DLECd\224}*+\229\133\160V\144\&2\130\206\184\237\149<\224\215\SO&\157Y\207\221\216\234\161R\156V\167%%\241\188\241\SO\151\165J\227l\178\249\206\129@\ah%A\250\176\253*\207\137\239?\179\146)\238\244\235[\165}\241\175\152rU\143L\130\&1\140\SI\235R^x'P\159ZMR\219(P\171BT\242\184\228\FS}k\164\190\208l\188E\DC4Q\234\150\146\219\220\169\a|c\130q\252\190\181\157\\\FS\166\160\251n\189H\149T\230\217\201\252>\213\&5+\141N\r>WY,\227\140\160}\132\ACKP0\a=\186{\215\182\248)\247\248uzq,\131\245\174.\203J\211\180\180\217f\140\EM\SOHM\219\&1\142\196\253}\235\189\240\204\vo\164\EOTA\180\EM\CAN\227\235]\148)\242'\165\174\246\&1\147\187\&6h\162\146\182\DLE\180RQ@\vE%\DC4\NULQE\DC4\NUL\180\148Q@\vU\174\236\227\188DY\v\NUL\167p\198(\162\128)\141\STX\208\ACK\NUL\176\r\212`s\250R\US\SI\218\NAK\v\150\218:\STX\ACK\a\233E\DC4\NUL\191\216p\DEL\207G\253)\223\216\150\255\NUL\243\210O\211\252(\162\128\">\FS\178g\SOZm\195\&8;\171F\218\217-b\242\208\177\EM\207\205E\DC4\SOH=\DC4Q@\ENQ\DC4Q@\ENQ\DC4Q@\US\255\217"

recreateDatabase :: Config -> IO ()
recreateDatabase config = do
  dir <- getCurrentDirectory
  runScript (connectionString config) $ dir ++ "/server/test/delete-db.sql"
  runScript (connectionString config) $ dir ++ "/server/database/database_setup.sql"
  upgradeDB config
  runScript (connectionString config) $ dir ++ "/server/test/create-groups.sql"